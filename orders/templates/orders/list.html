{% extends 'base.html' %}
{% load user_methods %}

{% block content %}
    <form method="get">
        {% comment %} // TODO: To delete customer field if user has no perm to view_order {% endcomment %}
        {{ filter.form.as_p }}
        <button type="submit">Apply</button>
        <a href="{% url 'orders:list' %}">Reset</a>
    </form>
    {% for order in filter.qs  %}
        <div class="card m-3">
            <div class="card-body" role="button" onclick="window.location='{{ order.get_absolute_url }}'">
                <h5 class="card-title">{{ order.distance }} km for {{ order.price }} UAH</h5>
                <div>Stops:
                    {% comment %} // TODO: Truncate stops {% endcomment %}
                    <ul>
                        {% for stop in order.stops %}
                            <li>{{ stop }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% if order.note %}
                    <figure class="note note-success p-4">
                        <blockquote class="blockquote">
                            {{ order.note }}
                        </blockquote>
                    </figure>
                {% endif %}
                <div>{{ order.get_car_type_display }} type</div>
                <div>{{ order.get_car_class_display }} class</div>
            </div>
            <div class="card-footer">
                {% has_perm  'accept_order' as can_accept_order %}
                {% if can_accept_order %}
                    <form action="{% url 'orders:accept' %}" method="post">
                        {% csrf_token %}
                        <input type="hidden" name="pk" value="{{ order.pk }}" readonly="readonly">
                        <button class="btn btn-primary w-100" type="submit">Accept</button>
                    </form>
                {% endif %}
            </div>
        </div>
    {% endfor %}
{% endblock content %}